!function(e,t){"use strict";var s,n,i,o,a,l,r=document.title,d={x:10,y:10},c={x:0,y:0},m=document.createElement("div"),u="-新消息提醒  ",y=0,p=function(e,t){var s;if(e&&t){for(var n=document.scripts,i=0,o=n.length;o>i;i++)if(n[i].src&&0<n[i].src.indexOf(e)){s=n[i].src;break}}else s=e?e:location.href;var a={};if(!s)return{str:"",json:a,domain:""};var l,r=s.indexOf("?"),d=s.indexOf("//")>-1?s.indexOf("//"):0,c=s.slice(d,s.indexOf("/",d+2)),m=s.slice(r+1).split("&");a.src=s.slice(0,r);for(var u=0,y=m.length;y>u;u++)l=m[u].split("="),a[l[0]]=l.length>1?decodeURIComponent(l[1]):"";return{str:s,json:a,domain:c}},f=p("easemob.js",!0);f.json.hide="false"===f.json.hide?!1:f.json.hide,f.json.sat="false"===f.json.sat?!1:f.json.sat;var h=function(){s.listenToIframe(function(e){var t,s,i,o="新消息提醒";if(e.indexOf("setuser")>-1&&(t=e.split("@").length>0?e.split("@")[1]:"",e=e.split("@").length>0?e.split("@")[0]:""),e.indexOf("notify")>-1&&(o=e.slice(6),e="notify"),e.indexOf("dragready")>-1){var a=e.slice(9);c.x=isNaN(Number(a.split("&")[0]))?0:Number(a.split("&")[0]),c.y=isNaN(Number(a.split("&")[1]))?0:Number(a.split("&")[1]),e="dragready"}if(e.indexOf("setchannel")>-1&&(s=e.split("@").length>0?e.split("@")[1]:"",e=e.split("@").length>0?e.split("@")[0]:""),e.indexOf("setgroupuser")>-1){var l=e.indexOf("@emgroupuser@");t=e.slice(13,l),i=e.slice(l+13),e="setgroupuser"}switch(e){case"msgPrompt":var p,h=(r+u).split("");clearInterval(y),y=setInterval(function(){p=h.shift(),document.title=p+Array.prototype.join.call(h,""),h.push(p)},360);break;case"notify":I(f.domain+"/webim/static/img/notify.png","新消息",o);break;case"recoveryTitle":clearInterval(y),document.title=r;break;case"showChat":n.style.width="400px",n.style.height="500px",n.style.visibility="visible",n.style.right=d.x+"px",n.style.bottom=d.y+"px",n.style.cssText+="box-shadow: 0 4px 8px rgba(0,0,0,.2);border-radius: 4px;border: 1px solid #ccc\\9;";break;case"minChat":v&&clearTimeout(v),n.style.boxShadow="none",n.style.borderRadius="4px;",n.style.left="auto",n.style.right="-5px",n.style.top="auto",n.style.bottom="10px",n.style.border="none",f.json.hide?(n.style.visibility="hidden",n.style.width="12px",n.style.height="12px"):(n.style.height="37px",n.style.width="104px");break;case"setuser":Emc.set("emKefuUser"+f.json.tenantId,t);break;case"setgroupuser":Emc.set(i+f.json.tenantId,t);break;case"setchannel":Emc.set("emKefuChannel"+f.json.tenantId,s);break;case"dragready":m.style.display="block",n.style.display="none",EasemobWidget.utils.on(document,"mousemove",w);break;case"dragend":j()}}),e.easemobIM=function(t){if(EasemobWidget.utils.isMobile){var n=document.getElementById(i),o=e.event.srcElement||e.event.target;t?(o.setAttribute("href",n.getAttribute("src")+"&emgroup="+t),o.setAttribute("target","_blank")):(o.setAttribute("href",n.getAttribute("src")),o.setAttribute("target","_blank"))}else if(t){var a=Emc.get(t+f.json.tenantId);s.sendToIframe("emgroup@"+a+"@emgroupuser@"+t)}else s.sendToIframe("imclick")}},g=function(){if(n=/MSIE (6|7|8)/.test(navigator.userAgent)?document.createElement('<iframe name="'+(new Date).getTime()+'">'):document.createElement("iframe"),i="EasemobIframe"+(new Date).getTime(),n.id=i,n.name=(new Date).getTime(),n.frameBorder=0,n.allowTransparency="true",n.style.cssText=["z-index:16777269;","overflow:hidden;","position:fixed;","bottom:10px;","right:-5px;","border:none;","width:400px;","height:0;","display:none;","transition:all .01s;"].join(""),m.style.cssText=["display:none;","cursor:move;","z-index:16777270;","position:fixed;","bottom:10px;","right:10px;","border:none;","width:400px;","height:500px;","border-radius:4px;","box-shadow: 0 4px 8px rgba(0,0,0,.2);","border-radius: 4px;"].join(""),m.style.background="url("+f.domain+"/webim/static/img/drag.png) no-repeat",l="initdata:"+f.domain+"/webim/im.html?tenantId="+f.json.tenantId+(f.json.hide?"&hide=true":"")+(f.json.sat?"&sat=true":"")+(f.json.color?"&color="+f.json.color:"")+(f.json.preview?"&preview="+f.json.preview:"")+(o?"&c="+o:"")+(a?"&u="+a:"")+"&time="+(new Date).getTime(),n.src=f.domain+"/webim/im.html?tenantId="+f.json.tenantId,f.json.hide?(n.style.height="12px",n.style.width="12px"):(n.style.height="37px",n.style.width="104px"),EasemobWidget.utils.isMobile&&(n.style.cssText+="left:0;bottom:0",n.style.width="100%"),f.json&&f.json.preview){var e=document.getElementById(f.json.previewid);e?e.appendChild(n):document.body.appendChild(n)}else document.body.appendChild(m),document.body.appendChild(n);n.readyState?n.onreadystatechange=function(){("loaded"===n.readyState||"complete"===n.readyState)&&(this.style.display="block",s=new TransferMessage(i),h(),s.sendToIframe(l))}:n.onload=function(){this.style.display="block",s=new TransferMessage(i),h(),s.sendToIframe(l)}},b=document.createElement("script");b.src=f.domain+"/webim/static/js/easemob.utils.js",(document.head||document.getElementsByTagName("head")[0]).appendChild(b),b.readyState?b.onreadystatechange=function(){("loaded"==b.readyState||"complete"==b.readyState)&&x()}:b.onload=function(){x()};var x=function(){a=Emc.get("emKefuUser"+f.json.tenantId),o=Emc.get("emKefuChannel"+f.json.tenantId),g(),EasemobWidget.utils.on(m,"mouseup",j),E()},v=0,w=function(t){var s=(e.event||t,document.documentElement.clientWidth),n=document.documentElement.clientHeight,i=s-t.clientX-400+c.x,o=n-t.clientY-500+c.y;t.clientX-c.x<=0?i=s-400:t.clientX+400-c.x>=s&&(i=0),t.clientY-c.y<=0?o=n-500:t.clientY+500-c.y>=n&&(o=0),m.style.left="auto",m.style.top="auto",m.style.right=i+"px",m.style.bottom=o+"px",d={x:i,y:o},clearTimeout(v),v=setTimeout(j,500)},j=function(){EasemobWidget.utils.remove(document,"mousemove",w),n.style.left="auto",n.style.top="auto",n.style.right=d.x+"px",n.style.bottom=d.y+"px",m.style.left="auto",m.style.top="auto",m.style.right=d.x+"px",m.style.bottom=d.y+"px",m.style.display="none",n.style.display="block",setTimeout(function(){s.sendToIframe("dragend")},3e3)},E=function(){EasemobWidget.utils.on(e,"resize",function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight,s=Number(n.style.right.slice(0,-2)),i=Number(n.style.bottom.slice(0,-2));400>e?(n.style.left="auto",n.style.right=0,m.style.left="auto",m.style.right=0):400>e-s?(n.style.right=e-400+"px",n.style.left=0,m.style.right=e-400+"px",m.style.left=0):(n.style.left="auto",m.style.left="auto"),500>t?(n.style.top="auto",n.style.bottom=0):500>t-i?(n.style.bottom=t-500+"px",n.style.top=0):n.style.top="auto"})},I=function(){var t=0;return function(s,n,i){if(0===t){t=setTimeout(function(){t=0},3e3),s=s||"",n=n||"",i=i||"";try{if(e.Notification)if("granted"===Notification.permission){var o=new Notification(n,{icon:s,body:i});o.onclick=function(){"function"==typeof e.focus&&e.focus(),this.close()},setTimeout(function(){o.close()},3e3)}else Notification.requestPermission()}catch(a){}}}}()}(window,void 0);