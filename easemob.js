!function(e,t){"use strict";var n,s,o,i,a,l,r=document.title,d={x:10,y:10},c={x:0,y:0},m=document.createElement("div"),u="-新消息提醒  ",p=0,y=document.referrer,f=function(e,t){var n;if(e&&t){for(var s=document.scripts,o=0,i=s.length;i>o;o++)if(s[o].src&&0<s[o].src.indexOf(e)){n=s[o].src;break}}else n=e?e:location.href;var a={};if(!n)return{str:"",json:a,domain:""};var l,r=n.indexOf("?"),d=n.indexOf("//")>-1?n.indexOf("//"):0,c=n.slice(d,n.indexOf("/",d+2)),m=n.slice(r+1).split("&");a.src=n.slice(0,r);for(var u=0,p=m.length;p>u;u++)l=m[u].split("="),a[l[0]]=l.length>1?decodeURIComponent(l[1]):"";return{str:n,json:a,domain:c}},h=f("easemob.js",!0);h.json.hide="false"===h.json.hide?!1:h.json.hide,h.json.sat="false"===h.json.sat?!1:h.json.sat,h.json.tenants="false"===h.json.tenants?!1:h.json.tenants;var g=function(){n.listenToIframe(function(e){var t,n,o,i="新消息提醒";if(e.indexOf("setuser")>-1&&(t=e.split("@").length>0?e.split("@")[1]:"",e=e.split("@").length>0?e.split("@")[0]:""),e.indexOf("notify")>-1&&(i=e.slice(6),e="notify"),e.indexOf("dragready")>-1){var a=e.slice(9);c.x=isNaN(Number(a.split("&")[0]))?0:Number(a.split("&")[0]),c.y=isNaN(Number(a.split("&")[1]))?0:Number(a.split("&")[1]),e="dragready"}if(e.indexOf("setchannel")>-1&&(n=e.split("@").length>0?e.split("@")[1]:"",e=e.split("@").length>0?e.split("@")[0]:""),e.indexOf("setgroupuser")>-1){var l=e.indexOf("@emgroupuser@");t=e.slice(13,l),o=e.slice(l+13),e="setgroupuser"}switch(e){case"msgPrompt":var y,f=(r+u).split("");clearInterval(p),p=setInterval(function(){y=f.shift(),document.title=y+Array.prototype.join.call(f,""),f.push(y)},360);break;case"notify":T(h.domain+"/webim/static/img/notify.png","新消息",i);break;case"recoveryTitle":clearInterval(p),document.title=r;break;case"showChat":s.style.width="400px",s.style.height="500px",s.style.visibility="visible",s.style.right=d.x+"px",s.style.bottom=d.y+"px",s.style.cssText+="box-shadow: 0 4px 8px rgba(0,0,0,.2);border-radius: 4px;border: 1px solid #ccc\\9;";break;case"minChat":v&&clearTimeout(v),s.style.boxShadow="none",s.style.borderRadius="4px;",s.style.left="auto",s.style.right="-5px",s.style.top="auto",s.style.bottom="10px",s.style.border="none",h.json.hide?(s.style.visibility="hidden",s.style.width="12px",s.style.height="12px"):(s.style.height="37px",s.style.width="104px");break;case"setuser":Emc.set("emKefuUser"+h.json.tenantId,t,h.json.tenants);break;case"setgroupuser":Emc.set(o+h.json.tenantId,t,h.json.tenants);break;case"setchannel":Emc.set("emKefuChannel"+h.json.tenantId,n,h.json.tenants);break;case"dragready":m.style.display="block",s.style.display="none",EasemobWidget.utils.on(document,"mousemove",w);break;case"dragend":E()}}),e.easemobIM=function(t){if(EasemobWidget.utils.isMobile){var s=document.getElementById(o),i=e.event.srcElement||e.event.target;t?(i.setAttribute("href",s.getAttribute("src")+"&emgroup="+t),i.setAttribute("target","_blank")):(i.setAttribute("href",s.getAttribute("src")),i.setAttribute("target","_blank"))}else if(t){var a=Emc.get(t+h.json.tenantId,h.json.tenants);n.sendToIframe("emgroup@"+a+"@emgroupuser@"+t)}else n.sendToIframe("imclick")}},b=function(){if(s=/MSIE (6|7|8)/.test(navigator.userAgent)?document.createElement('<iframe name="'+(new Date).getTime()+'">'):document.createElement("iframe"),o="EasemobIframe"+(new Date).getTime(),s.id=o,s.name=(new Date).getTime(),s.frameBorder=0,s.allowTransparency="true",s.style.cssText=["z-index:16777269;","overflow:hidden;","position:fixed;","bottom:10px;","right:-5px;","border:none;","width:400px;","height:0;","display:none;","transition:all .01s;"].join(""),m.style.cssText=["display:none;","cursor:move;","z-index:16777270;","position:fixed;","bottom:10px;","right:10px;","border:none;","width:400px;","height:500px;","border-radius:4px;","box-shadow: 0 4px 8px rgba(0,0,0,.2);","border-radius: 4px;"].join(""),m.style.background="url("+h.domain+"/webim/static/img/drag.png) no-repeat",l="initdata:"+h.domain+"/webim/im.html?tenantId="+h.json.tenantId+(h.json.hide?"&hide=true":"")+(h.json.sat?"&sat=true":"")+(h.json.color?"&color="+h.json.color:"")+(h.json.preview?"&preview="+h.json.preview:"")+(i?"&c="+i:"")+(a?"&u="+a:"")+"&time="+(new Date).getTime()+"&referrer="+encodeURIComponent(y),s.src=h.domain+"/webim/im.html?tenantId="+h.json.tenantId,h.json.hide?(s.style.height="12px",s.style.width="12px"):(s.style.height="37px",s.style.width="104px"),EasemobWidget.utils.isMobile&&(s.style.cssText+="left:0;bottom:0",s.style.width="100%"),h.json&&h.json.preview){var e=document.getElementById(h.json.previewid);e?e.appendChild(s):document.body.appendChild(s)}else document.body.appendChild(m),document.body.appendChild(s);s.readyState?s.onreadystatechange=function(){("loaded"===s.readyState||"complete"===s.readyState)&&(this.style.display="block",n=new TransferMessage(o),g(),n.sendToIframe(l))}:s.onload=function(){this.style.display="block",n=new TransferMessage(o),g(),n.sendToIframe(l)}},x=document.createElement("script");x.src=h.domain+"/webim/static/js/easemob.utils.js",(document.head||document.getElementsByTagName("head")[0]).appendChild(x),x.readyState?x.onreadystatechange=function(){("loaded"==x.readyState||"complete"==x.readyState)&&j()}:x.onload=function(){j()};var j=function(){a=Emc.get("emKefuUser"+h.json.tenantId,h.json.tenants),i=Emc.get("emKefuChannel"+h.json.tenantId,h.json.tenants),b(),EasemobWidget.utils.on(m,"mouseup",E),I()},v=0,w=function(t){var n=(e.event||t,document.documentElement.clientWidth),s=document.documentElement.clientHeight,o=n-t.clientX-400+c.x,i=s-t.clientY-500+c.y;t.clientX-c.x<=0?o=n-400:t.clientX+400-c.x>=n&&(o=0),t.clientY-c.y<=0?i=s-500:t.clientY+500-c.y>=s&&(i=0),m.style.left="auto",m.style.top="auto",m.style.right=o+"px",m.style.bottom=i+"px",d={x:o,y:i},clearTimeout(v),v=setTimeout(E,500)},E=function(){EasemobWidget.utils.remove(document,"mousemove",w),s.style.left="auto",s.style.top="auto",s.style.right=d.x+"px",s.style.bottom=d.y+"px",m.style.left="auto",m.style.top="auto",m.style.right=d.x+"px",m.style.bottom=d.y+"px",m.style.display="none",s.style.display="block",setTimeout(function(){n.sendToIframe("dragend")},3e3)},I=function(){EasemobWidget.utils.on(e,"resize",function(){var e=document.documentElement.clientWidth,t=document.documentElement.clientHeight,n=Number(s.style.right.slice(0,-2)),o=Number(s.style.bottom.slice(0,-2));400>e?(s.style.left="auto",s.style.right=0,m.style.left="auto",m.style.right=0):400>e-n?(s.style.right=e-400+"px",s.style.left=0,m.style.right=e-400+"px",m.style.left=0):(s.style.left="auto",m.style.left="auto"),500>t?(s.style.top="auto",s.style.bottom=0):500>t-o?(s.style.bottom=t-500+"px",s.style.top=0):s.style.top="auto"})},T=function(){var t=0;return function(n,s,o){if(0===t){t=setTimeout(function(){t=0},3e3),n=n||"",s=s||"",o=o||"";try{if(e.Notification)if("granted"===Notification.permission){var i=new Notification(s,{icon:n,body:o});i.onclick=function(){"function"==typeof e.focus&&e.focus(),this.close()},setTimeout(function(){i.close()},3e3)}else Notification.requestPermission()}catch(a){}}}}()}(window,void 0);